<?include header.priv.html ?>
<?lu
    if not session.logged or query.e.id == nil or query.e.u == nil or query.e.u ~= tostring(session.logged.id) then
        status("302 Temporary redirect")
        header("location", "/mail/login")
        return
    else
        local email = await(webmail.mail:load_mail(tostring(session.logged.id), query.e.id))
        if iserror(email) then
            | <h1>E-mail not found</h1>
            | <p>#[[email.error]]</p>
        else
            if email.subfolder == "" then
                email.subfolder = "[direct]"
                email.subfolderClass = "system"
            else
                email.subfolderClass = "custom"
            end
            | <h1>#[[email.subject]]</h1>
            | <span class="time">Received at: <nobr>#[[isodate(email.received)]]</nobr></span><br>
            | <span class="sender">Sender address: <nobr>#[[email.sender]]</nobr></span><br>
            | <span class="folder #[[email.subfolderClass]]">Folder: <nobr>#[[email.subfolder]]</nobr></span><br>
            | <pre>#[[email.body]]</pre>
        end
    end
?>
<?include footer.priv.html ?>