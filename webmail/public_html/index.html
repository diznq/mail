<?include header.priv.html ?>
<?lu
    if not session.logged then
        status("302 Temporary redirect")
        header("location", "/mail/login")
        return
    else
        local mails = await(webmail.mail:load_mails(tostring(session.logged.id)))
        if iserror(mails) then
            | <h1>Failed to load the mailbox</h1>
            | <p>Error: #[[mails.error]]</p>
        elseif #mails.mails == 0 then
            | <h1>Your mailbox is empty</h1>
        else
            | <h1>#[[#mails.mails]] e-mails received</h1>
            | <div class="e-mails">
            | <span class="header"><span>Folder</span><span>Sender</span><span class="subject">Subject</span><span>Time</span></span>
            for _, mail in ipairs(mails.mails) do
                if mail.subfolder == "" then
                    mail.subfolder = "[direct]"
                    mail.subfolderClass = "system"
                else
                    mail.subfolderClass = "custom"
                end
                ```
                <a href="#[[to_url('/mail/email', {id=mail.id, u=session.logged.id})]]" class="e-mail">
                    <span class="subfolder #[[mail.subfolderClass]]">#[[mail.subfolder]]</span>
                    <span class="sender">#[[mail.from.email]]</span>
                    <span class="subject">#[[mail.subject]]</span>
                    <span class="time"><nobr>#[[isodate(mail.received)]]</nobr></span>
                </a>
                ```
            end
            | </div>
        end
    end
?>
<?include footer.priv.html ?>